<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../oc-core-utils/oc-formatter.html">


<dom-module id="oc-transactions">
    <template>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <style include="shop-button" is="custom-style">

            :host {
                display: block;
                background: #fff;
                color: #000;
            }

            h3 {
                font-size: 1.13em !important;
                margin: 10px 0 !important;
            }

            paper-item {
                --paper-item-selected: {
                    color: #e0992f;
                };
            }

            .detail-view {
                padding-top: 5px;
                color: black;
                opacity: 0.8;
                border-top: 1px solid lightgrey;
            }
        </style>
        <div class="container-fluid">

            <div class="row">
                <div class="col-xs-12">
                    <template is="dom-if" if="[[_empty]]">
                        No Records to display
                    </template>
                </div>
            </div>

            <div class="row">
                <paper-listbox id="listbox" attr-for-selected="transaction" selected-values="{{_selectedTransactions}}" multi>
                    <template is="dom-repeat" items="[[transactions]]">
                        <paper-item style="padding: 0" transaction="[[item]]">
                            <paper-card style="width: 100%; margin-bottom: 3px">
                                <div class="card-content">
                                    <div class="row">
                                        <div class="col-xs-8">
                                            <div class="row">
                                                <div class="col-xs-12">
                                                    [[formatDate(item.dateTime)]]
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-xs-12">
                                                    <span style="opacity: 0.5">Account: [[item.accountName]]</span>
                                                </div>
                                            </div>
                                        </div>


                                        <div class="col-xs-4">
                                            <div class="pull-right">[[formatMoneyAmount(item.amount)]]</div>
                                        </div>
                                    </div>

                                    <div class="row" class="detail-view"
                                         hidden="[[!_isSelected(_selectedItems.*, item)]]"
                                         style="padding-top: 5px; color: black; opacity: 0.8; border-top: 1px solid lightgrey;">
                                        <div class="col-xs-12">
                                            <div>[[item.entryReference]]</div>
                                        </div>
                                        <div class="col-xs-4">
                                            <div>Ref#:</div>
                                        </div>
                                        <div class="col-xs-8">
                                            <div>[[item.reference]]</div>
                                        </div>
                                        <div class="col-xs-4">
                                            <div>Issued by:</div>
                                        </div>
                                        <div class="col-xs-8">
                                            <div>[[item.issuedByUser]]</div>
                                        </div>
                                        <div class="col-xs-4">
                                            <div>Status:</div>
                                        </div>
                                        <div class="col-xs-8">
                                            <div>[[item.status]]</div>
                                        </div>
                                        <div class="col-xs-4">
                                            <div>Method:</div>
                                        </div>
                                        <div class="col-xs-8">
                                            <div>[[item.method]]</div>
                                        </div>
                                    </div>
                                </div>
                            </paper-card>
                        </paper-item>
                    </template>
                </paper-listbox>
            </div>
        </div>
    </template>
    <script>
		/**
		 * `oc-transactions`
		 * List of transactions
		 *
		 * @customElement
		 * @polymer
		 * @demo demo/index.html
		 */
		class OcTransactions extends Ordercloud.Formatter(Polymer.Element) {
			static get is() {
				return 'oc-transactions';
			}

			static get properties() {
				return {
					transactions: {
						type: Array,
						value: [],
						observer: '_isEmpty'
					},
					_empty: {
						Type: Boolean,
						value: true
					},
					_selectedTransactions: {
						type: Array,
					},
					_selectedItems: {
						type: Object,
						value: {}
					}
				};
			}

			// Observe changes to the selected transactions array
			static get observers() {
				return [
					'_onTransactionSelected(_selectedTransactions.splices)'
				]
			}

			ready() {
				super.ready();
			}

			_onTransactionSelected(arrSplices) {
				if (!arrSplices) return;
				const selectedObjects = arrSplices.indexSplices[0].object;
				const removedObjects = arrSplices.indexSplices[0].removed;

				for (let i = 0; i < selectedObjects.length; i++) {
					this._selectedItems[selectedObjects[i].reference] = true;
					this.notifyPath('_selectedItems.' + selectedObjects[i].reference);
				}

				for (let j = 0; j < removedObjects.length; j++) {
					this._selectedItems[removedObjects[j].reference] = false;
					this.notifyPath('_selectedItems.' + removedObjects[j].reference);
				}
			}

			//check if there are records
			_isEmpty() {
				this._empty = !this.transactions.length > 0;
			}

			_isSelected(i, j) {
				if (!this._selectedItems[j.reference] && this._selectedItems[j.reference] !== false) {
					this._selectedItems[j.reference] = false;
				}

				return this._selectedItems[j.reference];
			}

			//check if there are records
			_computeStatus(status) {
				if (status === 'Success') {
					return "check";
				} else if (status.indexOf("Pending") >= 0) {
					return "watch-later";
				} else {
					return "error";
				}
			}
		}

		window.customElements.define(OcTransactions.is, OcTransactions);
    </script>
</dom-module>
